{"version":3,"sources":["../../../../../../src/modules/gemini-cli/src/core/executor.ts"],"sourcesContent":["/**\n * Gemini CLI Module - Executor\n * Handles running Gemini CLI commands and parsing results\n */\n\nimport { spawn } from 'child_process';\nimport { EventEmitter } from 'events';\nimport { GeminiExecutionError } from './errors.js';\nimport type {\n  AnalysisRequest,\n  AnalysisResult,\n  AnalysisType,\n  GeminiCLIConfig,\n  Finding,\n} from './types.js';\nimport { GeminiInstaller } from './installer.js';\nimport { GeminiCache } from './cache.js';\nimport { RateLimiter } from './rate-limiter.js';\n\nexport class GeminiExecutor extends EventEmitter {\n  private installer: GeminiInstaller;\n  private cache: GeminiCache;\n  private rateLimiter: RateLimiter;\n  private config: GeminiCLIConfig;\n\n  constructor(\n    installer: GeminiInstaller,\n    cache: GeminiCache,\n    rateLimiter: RateLimiter,\n    config: GeminiCLIConfig\n  ) {\n    super();\n    this.installer = installer;\n    this.cache = cache;\n    this.rateLimiter = rateLimiter;\n    this.config = config;\n  }\n\n  /**\n   * Execute an analysis request\n   */\n  async analyze(request: AnalysisRequest): Promise<AnalysisResult> {\n    const startTime = Date.now();\n    const requestId = this.generateRequestId();\n\n    // Check cache\n    const cacheKey = this.cache.generateKey(request as unknown as Record<string, unknown>);\n    const cached = await this.cache.get(cacheKey);\n    if (cached) {\n      this.emit('cache-hit', { requestId, cacheKey });\n      return cached;\n    }\n\n    // Check rate limit\n    await this.rateLimiter.waitForQuota();\n\n    // Get binary path\n    const binaryPath = await this.installer.findBinary();\n    if (!binaryPath) {\n      throw new GeminiExecutionError('Gemini CLI not installed', 'analyze');\n    }\n\n    // Build command\n    const args = this.buildAnalysisArgs(request);\n\n    this.emit('analysis-start', { requestId, request });\n\n    try {\n      // Execute command\n      const output = await this.executeCommand(binaryPath, args);\n\n      // Consume rate limit token\n      this.rateLimiter.consumeToken();\n\n      // Parse output\n      const result = this.parseAnalysisOutput(output, request, requestId, startTime);\n\n      // Cache result\n      await this.cache.set(cacheKey, result);\n\n      this.emit('analysis-complete', { requestId, result });\n\n      return result;\n    } catch (error) {\n      const errorResult: AnalysisResult = {\n        success: false,\n        requestId,\n        timestamp: new Date(),\n        duration: Date.now() - startTime,\n        tokenUsage: { prompt: 0, completion: 0, total: 0 },\n        summary: 'Analysis failed',\n        findings: [],\n        metrics: { filesAnalyzed: 0, linesOfCode: 0 },\n        recommendations: [],\n        errors: [error instanceof Error ? error.message : 'Unknown error'],\n      };\n\n      this.emit('analysis-error', { requestId, error });\n\n      return errorResult;\n    }\n  }\n\n  /**\n   * Run security scan\n   */\n  async securityScan(target: string, options?: Partial<AnalysisRequest>): Promise<AnalysisResult> {\n    return this.analyze({\n      type: 'security',\n      target,\n      depth: 'deep',\n      focus: ['vulnerabilities', 'secrets', 'misconfig'],\n      ...options,\n    });\n  }\n\n  /**\n   * Run architecture analysis\n   */\n  async architectureMap(target: string, options?: Partial<AnalysisRequest>): Promise<AnalysisResult> {\n    return this.analyze({\n      type: 'architecture',\n      target,\n      depth: 'comprehensive',\n      focus: ['components', 'dependencies', 'layers'],\n      ...options,\n    });\n  }\n\n  /**\n   * Run dependency analysis\n   */\n  async dependencyAnalysis(target: string, options?: Partial<AnalysisRequest>): Promise<AnalysisResult> {\n    return this.analyze({\n      type: 'dependencies',\n      target,\n      depth: 'deep',\n      focus: ['outdated', 'vulnerabilities', 'licenses'],\n      ...options,\n    });\n  }\n\n  /**\n   * Run coverage assessment\n   */\n  async coverageAssess(target: string, options?: Partial<AnalysisRequest>): Promise<AnalysisResult> {\n    return this.analyze({\n      type: 'coverage',\n      target,\n      depth: 'moderate',\n      focus: ['untested', 'quality', 'edge-cases'],\n      ...options,\n    });\n  }\n\n  /**\n   * Verify feature implementation\n   */\n  async verify(feature: string, target: string): Promise<{ implemented: boolean; confidence: number; details: string }> {\n    const result = await this.analyze({\n      type: 'codebase',\n      target,\n      query: `Verify if this feature is implemented: \"${feature}\". Return JSON with fields: implemented (boolean), confidence (0-100), details (string)`,\n      outputFormat: 'json',\n    });\n\n    try {\n      const verification = JSON.parse(result.rawOutput || '{}');\n      return {\n        implemented: verification.implemented ?? false,\n        confidence: verification.confidence ?? 0,\n        details: verification.details ?? result.summary,\n      };\n    } catch {\n      return {\n        implemented: false,\n        confidence: 0,\n        details: result.summary,\n      };\n    }\n  }\n\n  // ============================================\n  // Private Methods\n  // ============================================\n\n  private generateRequestId(): string {\n    return `gemini-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n  }\n\n  private buildAnalysisArgs(request: AnalysisRequest): string[] {\n    const args: string[] = [];\n\n    // Target paths\n    const targets = Array.isArray(request.target) ? request.target : [request.target];\n    args.push(...targets.map(t => `@${t}`));\n\n    // Analysis type prompt\n    const typePrompts: Record<AnalysisType, string> = {\n      codebase: 'Analyze this codebase comprehensively. Identify patterns, structure, and key components.',\n      architecture: 'Map the architecture of this codebase. Identify components, layers, dependencies, and data flows.',\n      security: 'Perform a security audit. Find vulnerabilities, insecure patterns, hardcoded secrets, and misconfigurations.',\n      dependencies: 'Analyze dependencies. Find outdated packages, vulnerabilities, license issues, and unused dependencies.',\n      coverage: 'Assess test coverage. Identify untested code paths, missing edge cases, and testing recommendations.',\n    };\n\n    let prompt = typePrompts[request.type];\n\n    // Add custom query\n    if (request.query) {\n      prompt += `\\n\\nAdditional focus: ${request.query}`;\n    }\n\n    // Add focus areas\n    if (request.focus && request.focus.length > 0) {\n      prompt += `\\n\\nFocus on: ${request.focus.join(', ')}`;\n    }\n\n    // Add depth instruction\n    if (request.depth) {\n      const depthInstructions: Record<string, string> = {\n        surface: 'Provide a quick overview without deep analysis.',\n        moderate: 'Provide moderate detail with key findings.',\n        deep: 'Provide detailed analysis with comprehensive findings.',\n        comprehensive: 'Provide exhaustive analysis covering all aspects.',\n      };\n      prompt += `\\n\\n${depthInstructions[request.depth]}`;\n    }\n\n    // Request structured output\n    prompt += '\\n\\nReturn structured output with: summary, findings (type, severity, location, message, suggestion), metrics, and recommendations.';\n\n    args.push('-p', prompt);\n\n    // Output format\n    if (request.outputFormat === 'json') {\n      args.push('--json');\n    }\n\n    return args;\n  }\n\n  private async executeCommand(binaryPath: string, args: string[]): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const child = spawn(binaryPath, args, {\n        timeout: this.config.analysis.timeout,\n      });\n\n      let stdout = '';\n      let stderr = '';\n\n      child.stdout.on('data', (data) => {\n        const chunk = data.toString();\n        stdout += chunk;\n        this.emit('output', { type: 'stdout', data: chunk });\n      });\n\n      child.stderr.on('data', (data) => {\n        const chunk = data.toString();\n        stderr += chunk;\n        this.emit('output', { type: 'stderr', data: chunk });\n      });\n\n      child.on('close', (code) => {\n        if (code === 0) {\n          resolve(stdout);\n        } else {\n          reject(\n            new GeminiExecutionError(\n              `Command failed with code ${code}: ${stderr}`,\n              'analyze',\n              { exitCode: code, stderr }\n            )\n          );\n        }\n      });\n\n      child.on('error', (error) => {\n        reject(\n          new GeminiExecutionError(\n            `Failed to execute command: ${error.message}`,\n            'analyze',\n            { error: error.message }\n          )\n        );\n      });\n    });\n  }\n\n  private parseAnalysisOutput(\n    output: string,\n    request: AnalysisRequest,\n    requestId: string,\n    startTime: number\n  ): AnalysisResult {\n    const duration = Date.now() - startTime;\n\n    // Try to parse as JSON first\n    try {\n      const parsed = JSON.parse(output);\n      return {\n        success: true,\n        requestId,\n        timestamp: new Date(),\n        duration,\n        tokenUsage: parsed.tokenUsage || { prompt: 0, completion: 0, total: 0 },\n        summary: parsed.summary || 'Analysis complete',\n        findings: this.normalizeFindings(parsed.findings || []),\n        metrics: parsed.metrics || { filesAnalyzed: 0, linesOfCode: 0 },\n        recommendations: parsed.recommendations || [],\n        rawOutput: output,\n      };\n    } catch {\n      // Parse as text\n      return {\n        success: true,\n        requestId,\n        timestamp: new Date(),\n        duration,\n        tokenUsage: { prompt: 0, completion: 0, total: 0 },\n        summary: this.extractSummary(output),\n        findings: this.extractFindings(output),\n        metrics: { filesAnalyzed: 0, linesOfCode: 0 },\n        recommendations: this.extractRecommendations(output),\n        rawOutput: output,\n      };\n    }\n  }\n\n  private normalizeFindings(findings: unknown[]): Finding[] {\n    return findings.map((f: unknown) => {\n      const finding = f as Record<string, unknown>;\n      return {\n        type: (finding.type as string) || 'general',\n        severity: this.normalizeSeverity(finding.severity as string),\n        location: (finding.location as string) || (finding.file as string) || 'unknown',\n        message: (finding.message as string) || (finding.description as string) || '',\n        suggestion: finding.suggestion as string | undefined || finding.recommendation as string | undefined,\n        code: finding.code as string | undefined,\n        line: finding.line as number | undefined,\n        column: finding.column as number | undefined,\n      };\n    });\n  }\n\n  private normalizeSeverity(severity: string): Finding['severity'] {\n    const normalized = (severity || '').toLowerCase();\n    if (['critical', 'high', 'medium', 'low', 'info'].includes(normalized)) {\n      return normalized as Finding['severity'];\n    }\n    return 'info';\n  }\n\n  private extractSummary(output: string): string {\n    const lines = output.split('\\n');\n    const summaryLines = lines.slice(0, 5).filter(l => l.trim());\n    return summaryLines.join(' ').slice(0, 500);\n  }\n\n  private extractFindings(output: string): Finding[] {\n    // Basic extraction from text output\n    const findings: Finding[] = [];\n    const patterns = [\n      /(?:error|warning|issue|vulnerability|problem):\\s*(.+)/gi,\n      /(?:found|detected|identified):\\s*(.+)/gi,\n    ];\n\n    for (const pattern of patterns) {\n      let match;\n      while ((match = pattern.exec(output)) !== null) {\n        findings.push({\n          type: 'general',\n          severity: 'info',\n          location: 'unknown',\n          message: match[1].trim(),\n        });\n      }\n    }\n\n    return findings;\n  }\n\n  private extractRecommendations(output: string): Array<{ type: string; priority: 'high' | 'medium' | 'low'; description: string }> {\n    const recommendations: Array<{ type: string; priority: 'high' | 'medium' | 'low'; description: string }> = [];\n    const patterns = [\n      /(?:recommend|suggest|should|consider):\\s*(.+)/gi,\n      /(?:recommendation|suggestion):\\s*(.+)/gi,\n    ];\n\n    for (const pattern of patterns) {\n      let match;\n      while ((match = pattern.exec(output)) !== null) {\n        recommendations.push({\n          type: 'general',\n          priority: 'medium',\n          description: match[1].trim(),\n        });\n      }\n    }\n\n    return recommendations;\n  }\n}\n"],"names":["spawn","EventEmitter","GeminiExecutionError","GeminiExecutor","installer","cache","rateLimiter","config","analyze","request","startTime","Date","now","requestId","generateRequestId","cacheKey","generateKey","cached","get","emit","waitForQuota","binaryPath","findBinary","args","buildAnalysisArgs","output","executeCommand","consumeToken","result","parseAnalysisOutput","set","error","errorResult","success","timestamp","duration","tokenUsage","prompt","completion","total","summary","findings","metrics","filesAnalyzed","linesOfCode","recommendations","errors","Error","message","securityScan","target","options","type","depth","focus","architectureMap","dependencyAnalysis","coverageAssess","verify","feature","query","outputFormat","verification","JSON","parse","rawOutput","implemented","confidence","details","Math","random","toString","slice","targets","Array","isArray","push","map","t","typePrompts","codebase","architecture","security","dependencies","coverage","length","join","depthInstructions","surface","moderate","deep","comprehensive","Promise","resolve","reject","child","timeout","analysis","stdout","stderr","on","data","chunk","code","exitCode","parsed","normalizeFindings","extractSummary","extractFindings","extractRecommendations","f","finding","severity","normalizeSeverity","location","file","description","suggestion","recommendation","line","column","normalized","toLowerCase","includes","lines","split","summaryLines","filter","l","trim","patterns","pattern","match","exec","priority"],"mappings":"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"}