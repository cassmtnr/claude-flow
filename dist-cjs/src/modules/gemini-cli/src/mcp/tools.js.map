{"version":3,"sources":["../../../../../../src/modules/gemini-cli/src/mcp/tools.ts"],"sourcesContent":["/**\n * Gemini CLI MCP Tool Definitions\n *\n * Defines the 5 analysis tools exposed through MCP:\n * - codebase_analyze: Comprehensive codebase analysis\n * - architecture_map: System architecture mapping\n * - security_scan: Security vulnerability scanning\n * - dependency_analyze: Dependency analysis\n * - coverage_assess: Test coverage assessment\n */\n\nimport type { AnalysisType, AnalysisDepth, OutputFormat } from '../core/types.js';\n\n// ============================================\n// Tool Input/Output Types\n// ============================================\n\nexport interface CodebaseAnalyzeInput {\n  paths: string[];\n  query?: string;\n  depth?: AnalysisDepth;\n  outputFormat?: OutputFormat;\n  excludePatterns?: string[];\n  focusAreas?: string[];\n  storeInMemory?: boolean;\n}\n\nexport interface ArchitectureMapInput {\n  path: string;\n  includeDataFlows?: boolean;\n  includeDependencies?: boolean;\n  outputFormat?: OutputFormat;\n  depth?: AnalysisDepth;\n}\n\nexport interface SecurityScanInput {\n  path: string;\n  scanTypes?: ('vulnerabilities' | 'secrets' | 'misconfig' | 'dependencies')[];\n  depth?: AnalysisDepth;\n  outputFormat?: OutputFormat;\n  severityThreshold?: 'critical' | 'high' | 'medium' | 'low';\n}\n\nexport interface DependencyAnalyzeInput {\n  path: string;\n  checkOutdated?: boolean;\n  checkVulnerabilities?: boolean;\n  checkLicenses?: boolean;\n  outputFormat?: OutputFormat;\n}\n\nexport interface CoverageAssessInput {\n  path: string;\n  testDirectory?: string;\n  focusAreas?: string[];\n  outputFormat?: OutputFormat;\n  depth?: AnalysisDepth;\n}\n\n// ============================================\n// Tool Definition Interface\n// ============================================\n\nexport interface GeminiToolDefinition {\n  id: string;\n  name: string;\n  description: string;\n  category: 'analysis' | 'security' | 'architecture' | 'quality';\n  inputSchema: {\n    type: 'object';\n    properties: Record<string, unknown>;\n    required: string[];\n  };\n  outputSchema: {\n    type: 'object';\n    properties: Record<string, unknown>;\n  };\n  disclosure: {\n    level: 'basic' | 'standard' | 'full';\n    triggers: string[];\n    priority: number;\n  };\n  estimatedDuration: string;\n  tokenEstimate: string;\n}\n\n// ============================================\n// Tool Definitions\n// ============================================\n\nexport const GeminiCLIToolDefinitions: GeminiToolDefinition[] = [\n  // 1. Codebase Analyze Tool\n  {\n    id: 'codebase_analyze',\n    name: 'Codebase Analysis',\n    description:\n      'Comprehensive codebase analysis using Gemini\\'s 1M+ token context. ' +\n      'Analyzes code structure, patterns, quality, and provides actionable insights. ' +\n      'Ideal for understanding large codebases, identifying patterns, and code review.',\n    category: 'analysis',\n    inputSchema: {\n      type: 'object',\n      properties: {\n        paths: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Paths to analyze (files or directories)',\n          default: ['.'],\n        },\n        query: {\n          type: 'string',\n          description: 'Specific question or focus area for analysis',\n        },\n        depth: {\n          type: 'string',\n          enum: ['surface', 'moderate', 'deep', 'comprehensive'],\n          description: 'Analysis depth level',\n          default: 'moderate',\n        },\n        outputFormat: {\n          type: 'string',\n          enum: ['json', 'markdown', 'text'],\n          description: 'Output format',\n          default: 'markdown',\n        },\n        excludePatterns: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Glob patterns to exclude',\n        },\n        focusAreas: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Specific areas to focus on',\n        },\n        storeInMemory: {\n          type: 'boolean',\n          description: 'Store results in Claude Flow memory',\n          default: false,\n        },\n      },\n      required: ['paths'],\n    },\n    outputSchema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        summary: { type: 'string' },\n        findings: { type: 'array' },\n        metrics: { type: 'object' },\n        recommendations: { type: 'array' },\n      },\n    },\n    disclosure: {\n      level: 'standard',\n      triggers: ['analyze', 'codebase', 'review', 'understand', 'examine'],\n      priority: 80,\n    },\n    estimatedDuration: '30-120 seconds',\n    tokenEstimate: '10,000-100,000 tokens',\n  },\n\n  // 2. Architecture Map Tool\n  {\n    id: 'architecture_map',\n    name: 'Architecture Mapping',\n    description:\n      'Maps system architecture including components, layers, dependencies, and data flows. ' +\n      'Uses Gemini\\'s large context to understand complex system structures. ' +\n      'Generates visual diagrams and detailed component descriptions.',\n    category: 'architecture',\n    inputSchema: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'Root path to analyze',\n          default: '.',\n        },\n        includeDataFlows: {\n          type: 'boolean',\n          description: 'Include data flow analysis',\n          default: true,\n        },\n        includeDependencies: {\n          type: 'boolean',\n          description: 'Include dependency graph',\n          default: true,\n        },\n        outputFormat: {\n          type: 'string',\n          enum: ['json', 'markdown', 'text'],\n          description: 'Output format',\n          default: 'markdown',\n        },\n        depth: {\n          type: 'string',\n          enum: ['surface', 'moderate', 'deep', 'comprehensive'],\n          description: 'Analysis depth',\n          default: 'comprehensive',\n        },\n      },\n      required: ['path'],\n    },\n    outputSchema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        components: { type: 'array' },\n        layers: { type: 'array' },\n        dependencies: { type: 'object' },\n        dataFlows: { type: 'array' },\n        diagram: { type: 'string' },\n      },\n    },\n    disclosure: {\n      level: 'standard',\n      triggers: ['architecture', 'structure', 'components', 'diagram', 'design'],\n      priority: 75,\n    },\n    estimatedDuration: '45-180 seconds',\n    tokenEstimate: '20,000-150,000 tokens',\n  },\n\n  // 3. Security Scan Tool\n  {\n    id: 'security_scan',\n    name: 'Security Vulnerability Scan',\n    description:\n      'Comprehensive security audit using Gemini\\'s context understanding. ' +\n      'Identifies vulnerabilities, hardcoded secrets, misconfigurations, and insecure patterns. ' +\n      'Provides severity ratings and remediation suggestions.',\n    category: 'security',\n    inputSchema: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'Path to scan',\n          default: '.',\n        },\n        scanTypes: {\n          type: 'array',\n          items: {\n            type: 'string',\n            enum: ['vulnerabilities', 'secrets', 'misconfig', 'dependencies'],\n          },\n          description: 'Types of security issues to scan for',\n          default: ['vulnerabilities', 'secrets', 'misconfig'],\n        },\n        depth: {\n          type: 'string',\n          enum: ['surface', 'moderate', 'deep', 'comprehensive'],\n          description: 'Scan depth',\n          default: 'deep',\n        },\n        outputFormat: {\n          type: 'string',\n          enum: ['json', 'markdown', 'text'],\n          description: 'Output format',\n          default: 'markdown',\n        },\n        severityThreshold: {\n          type: 'string',\n          enum: ['critical', 'high', 'medium', 'low'],\n          description: 'Minimum severity to report',\n          default: 'low',\n        },\n      },\n      required: ['path'],\n    },\n    outputSchema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        summary: { type: 'string' },\n        vulnerabilities: { type: 'array' },\n        secrets: { type: 'array' },\n        misconfigurations: { type: 'array' },\n        riskScore: { type: 'number' },\n        remediations: { type: 'array' },\n      },\n    },\n    disclosure: {\n      level: 'standard',\n      triggers: ['security', 'vulnerability', 'audit', 'secrets', 'scan'],\n      priority: 90,\n    },\n    estimatedDuration: '60-240 seconds',\n    tokenEstimate: '30,000-200,000 tokens',\n  },\n\n  // 4. Dependency Analyze Tool\n  {\n    id: 'dependency_analyze',\n    name: 'Dependency Analysis',\n    description:\n      'Analyzes project dependencies for outdated packages, vulnerabilities, license issues, ' +\n      'and unused dependencies. Provides upgrade paths and compatibility insights.',\n    category: 'quality',\n    inputSchema: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'Path to package manifest',\n          default: '.',\n        },\n        checkOutdated: {\n          type: 'boolean',\n          description: 'Check for outdated packages',\n          default: true,\n        },\n        checkVulnerabilities: {\n          type: 'boolean',\n          description: 'Check for known vulnerabilities',\n          default: true,\n        },\n        checkLicenses: {\n          type: 'boolean',\n          description: 'Check license compatibility',\n          default: true,\n        },\n        outputFormat: {\n          type: 'string',\n          enum: ['json', 'markdown', 'text'],\n          description: 'Output format',\n          default: 'markdown',\n        },\n      },\n      required: ['path'],\n    },\n    outputSchema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        summary: { type: 'string' },\n        outdated: { type: 'array' },\n        vulnerabilities: { type: 'array' },\n        licenseIssues: { type: 'array' },\n        unused: { type: 'array' },\n        upgradePaths: { type: 'array' },\n      },\n    },\n    disclosure: {\n      level: 'standard',\n      triggers: ['dependency', 'dependencies', 'packages', 'npm', 'outdated'],\n      priority: 70,\n    },\n    estimatedDuration: '20-90 seconds',\n    tokenEstimate: '5,000-50,000 tokens',\n  },\n\n  // 5. Coverage Assess Tool\n  {\n    id: 'coverage_assess',\n    name: 'Test Coverage Assessment',\n    description:\n      'Assesses test coverage and identifies untested code paths, missing edge cases, ' +\n      'and testing gaps. Provides recommendations for improving test coverage.',\n    category: 'quality',\n    inputSchema: {\n      type: 'object',\n      properties: {\n        path: {\n          type: 'string',\n          description: 'Path to source code',\n          default: '.',\n        },\n        testDirectory: {\n          type: 'string',\n          description: 'Path to test files',\n        },\n        focusAreas: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Specific areas to assess',\n        },\n        outputFormat: {\n          type: 'string',\n          enum: ['json', 'markdown', 'text'],\n          description: 'Output format',\n          default: 'markdown',\n        },\n        depth: {\n          type: 'string',\n          enum: ['surface', 'moderate', 'deep', 'comprehensive'],\n          description: 'Assessment depth',\n          default: 'moderate',\n        },\n      },\n      required: ['path'],\n    },\n    outputSchema: {\n      type: 'object',\n      properties: {\n        success: { type: 'boolean' },\n        summary: { type: 'string' },\n        coverageScore: { type: 'number' },\n        untestedPaths: { type: 'array' },\n        missingEdgeCases: { type: 'array' },\n        recommendations: { type: 'array' },\n      },\n    },\n    disclosure: {\n      level: 'standard',\n      triggers: ['coverage', 'test', 'testing', 'untested', 'edge cases'],\n      priority: 65,\n    },\n    estimatedDuration: '30-120 seconds',\n    tokenEstimate: '10,000-80,000 tokens',\n  },\n];\n\n// ============================================\n// Tool ID to Analysis Type Mapping\n// ============================================\n\nexport const toolIdToAnalysisType: Record<string, AnalysisType> = {\n  codebase_analyze: 'codebase',\n  architecture_map: 'architecture',\n  security_scan: 'security',\n  dependency_analyze: 'dependencies',\n  coverage_assess: 'coverage',\n};\n\n// ============================================\n// Get Tool by ID\n// ============================================\n\nexport function getToolDefinition(toolId: string): GeminiToolDefinition | undefined {\n  return GeminiCLIToolDefinitions.find((t) => t.id === toolId);\n}\n\n// ============================================\n// Get All Tool IDs\n// ============================================\n\nexport function getAllToolIds(): string[] {\n  return GeminiCLIToolDefinitions.map((t) => t.id);\n}\n"],"names":["GeminiCLIToolDefinitions","id","name","description","category","inputSchema","type","properties","paths","items","default","query","depth","enum","outputFormat","excludePatterns","focusAreas","storeInMemory","required","outputSchema","success","summary","findings","metrics","recommendations","disclosure","level","triggers","priority","estimatedDuration","tokenEstimate","path","includeDataFlows","includeDependencies","components","layers","dependencies","dataFlows","diagram","scanTypes","severityThreshold","vulnerabilities","secrets","misconfigurations","riskScore","remediations","checkOutdated","checkVulnerabilities","checkLicenses","outdated","licenseIssues","unused","upgradePaths","testDirectory","coverageScore","untestedPaths","missingEdgeCases","toolIdToAnalysisType","codebase_analyze","architecture_map","security_scan","dependency_analyze","coverage_assess","getToolDefinition","toolId","find","t","getAllToolIds","map"],"mappings":"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"}