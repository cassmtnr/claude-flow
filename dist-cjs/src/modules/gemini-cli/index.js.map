{"version":3,"sources":["../../../../src/modules/gemini-cli/index.js"],"sourcesContent":["// gemini-cli/index.js - JavaScript bridge for the TypeScript Gemini CLI module\n// This file provides a JS entrypoint that works in both development and production\n// Re-exports from the core module for runtime compatibility\n\nimport { EventEmitter } from 'events';\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as os from 'os';\n\n// Try to import from compiled TypeScript first, fall back to JS implementation\nlet _getGeminiModule;\ntry {\n  const core = await import('./src/core/index.js');\n  _getGeminiModule = core.getGeminiModule;\n} catch {\n  // Fall back to inline implementation below\n  _getGeminiModule = null;\n}\n\n// Default configuration\nconst DEFAULT_CONFIG = {\n  enabled: false,\n  authMethod: 'google-login',\n  defaultModel: 'gemini-2.5-pro',\n  contextLimit: 1000000,\n  requestsPerMinute: 60,\n  requestsPerDay: 1000,\n  analysis: {\n    defaultType: 'codebase',\n    outputFormat: 'markdown',\n    storeInMemory: true,\n    excludePatterns: [\n      'node_modules/**',\n      'dist/**',\n      '.git/**',\n      '*.min.js',\n      '*.map',\n      'coverage/**',\n      '.next/**',\n      'build/**',\n    ],\n    maxFileSize: 10485760,\n    timeout: 300000,\n  },\n  cache: {\n    enabled: true,\n    ttl: 3600000,\n    maxSize: 100,\n    directory: '.claude-flow/cache/gemini',\n  },\n  rateLimit: {\n    enabled: true,\n    requestsPerMinute: 60,\n    requestsPerDay: 1000,\n    burstLimit: 10,\n  },\n};\n\n// Simple in-memory cache\nclass SimpleCache {\n  constructor(config) {\n    this.config = config;\n    this.cache = new Map();\n  }\n\n  async initialize() {}\n\n  generateKey(params) {\n    return JSON.stringify(params);\n  }\n\n  async get(key) {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n    if (Date.now() - entry.createdAt > this.config.ttl) {\n      this.cache.delete(key);\n      return null;\n    }\n    return entry.value;\n  }\n\n  async set(key, value) {\n    this.cache.set(key, { value, createdAt: Date.now() });\n  }\n\n  async clear() {\n    this.cache.clear();\n  }\n\n  getStats() {\n    return { entries: this.cache.size, size: 0, hitRate: 0 };\n  }\n}\n\n// Simple rate limiter\nclass SimpleRateLimiter {\n  constructor(config) {\n    this.config = config;\n    this.minuteTokens = config.requestsPerMinute;\n    this.dayTokens = config.requestsPerDay;\n    this.lastMinuteRefill = Date.now();\n    this.lastDayRefill = Date.now();\n  }\n\n  canMakeRequest() {\n    if (!this.config.enabled) return true;\n    this.refill();\n    return this.minuteTokens >= 1 && this.dayTokens >= 1;\n  }\n\n  consumeToken() {\n    if (!this.config.enabled) return;\n    this.refill();\n    this.minuteTokens--;\n    this.dayTokens--;\n  }\n\n  async waitForQuota() {\n    while (!this.canMakeRequest()) {\n      await new Promise(resolve => setTimeout(resolve, 1000));\n    }\n  }\n\n  getQuotaStatus() {\n    return {\n      requestsPerMinute: {\n        used: Math.floor(this.config.requestsPerMinute - this.minuteTokens),\n        limit: this.config.requestsPerMinute,\n        resetAt: new Date(this.lastMinuteRefill + 60000),\n      },\n      requestsPerDay: {\n        used: Math.floor(this.config.requestsPerDay - this.dayTokens),\n        limit: this.config.requestsPerDay,\n        resetAt: new Date(this.lastDayRefill + 86400000),\n      },\n    };\n  }\n\n  refill() {\n    const now = Date.now();\n    const minuteElapsed = now - this.lastMinuteRefill;\n    if (minuteElapsed >= 60000) {\n      this.minuteTokens = this.config.requestsPerMinute;\n      this.lastMinuteRefill = now;\n    }\n    const dayElapsed = now - this.lastDayRefill;\n    if (dayElapsed >= 86400000) {\n      this.dayTokens = this.config.requestsPerDay;\n      this.lastDayRefill = now;\n    }\n  }\n}\n\n// Module manager implementation\nclass GeminiModuleManager extends EventEmitter {\n  static instance = null;\n\n  constructor() {\n    super();\n    this.config = { ...DEFAULT_CONFIG };\n    this.cache = new SimpleCache(this.config.cache);\n    this.rateLimiter = new SimpleRateLimiter(this.config.rateLimit);\n    this.initialized = false;\n    this.executor = null;\n  }\n\n  static getInstance() {\n    if (!GeminiModuleManager.instance) {\n      GeminiModuleManager.instance = new GeminiModuleManager();\n    }\n    return GeminiModuleManager.instance;\n  }\n\n  async initialize() {\n    if (this.initialized) return;\n    await this.loadConfig();\n    await this.cache.initialize();\n    this.initialized = true;\n  }\n\n  async enable(options = {}) {\n    console.log('üöÄ Enabling Gemini CLI module...');\n    await this.initialize();\n\n    // Check if gemini CLI is installed\n    const { exec, spawn } = await import('child_process');\n    const { promisify } = await import('util');\n    const execAsync = promisify(exec);\n\n    try {\n      await execAsync('which gemini');\n    } catch {\n      if (!options.skipInstall) {\n        console.log('üì¶ Installing Gemini CLI...');\n        try {\n          await execAsync('npm install -g @google/gemini-cli', { timeout: 120000 });\n          console.log('‚úÖ Gemini CLI installed');\n        } catch (err) {\n          throw new Error(`Failed to install Gemini CLI: ${err.message}`);\n        }\n      }\n    }\n\n    const authMethod = options.authMethod || 'google-login';\n\n    // Perform authentication based on method\n    if (authMethod === 'google-login') {\n      // Check if already authenticated\n      const oauthCredsPath = path.join(os.homedir(), '.gemini', 'oauth_creds.json');\n      let alreadyAuthenticated = false;\n      try {\n        await fs.access(oauthCredsPath);\n        alreadyAuthenticated = true;\n      } catch {\n        // Not authenticated yet\n      }\n\n      if (alreadyAuthenticated && !options.force) {\n        console.log('‚úÖ Already authenticated with Google OAuth');\n      } else {\n        console.log('üîê Starting Google OAuth login...');\n        console.log('   Opening browser for authentication...');\n\n        await new Promise((resolve, reject) => {\n          const child = spawn('gemini', ['auth', 'login'], {\n            stdio: 'inherit', // Show output directly to user\n          });\n\n          child.on('close', (code) => {\n            if (code === 0) {\n              console.log('‚úÖ Google authentication successful');\n              resolve();\n            } else {\n              reject(new Error(`Authentication failed with code ${code}`));\n            }\n          });\n\n          child.on('error', (err) => {\n            reject(new Error(`Failed to start auth: ${err.message}`));\n          });\n        });\n      }\n    } else if (authMethod === 'api-key') {\n      if (!options.apiKey) {\n        throw new Error('API key required for api-key authentication');\n      }\n      console.log('üîë Setting up API key authentication...');\n      // API key will be stored in config\n    } else if (authMethod === 'vertex-ai') {\n      if (!options.vertexProject) {\n        throw new Error('Vertex project required for vertex-ai authentication');\n      }\n      console.log('‚òÅÔ∏è  Setting up Vertex AI authentication...');\n    }\n\n    this.config.enabled = true;\n    this.config.authMethod = authMethod;\n    if (options.apiKey) this.config.apiKey = options.apiKey;\n    if (options.vertexProject) this.config.vertexProject = options.vertexProject;\n    if (options.vertexLocation) this.config.vertexLocation = options.vertexLocation;\n\n    await this.saveConfig();\n    console.log('‚úÖ Gemini CLI module enabled');\n  }\n\n  async disable() {\n    console.log('‚è∏Ô∏è  Disabling Gemini CLI module...');\n    this.config.enabled = false;\n    this.executor = null;\n    await this.saveConfig();\n    console.log('‚úÖ Gemini CLI module disabled');\n  }\n\n  async eject(options = {}) {\n    console.log('üóëÔ∏è  Ejecting Gemini CLI module...');\n    await this.disable();\n    await this.cache.clear();\n    if (!options.keepConfig) {\n      this.config = { ...DEFAULT_CONFIG };\n      await this.deleteConfig();\n    }\n    console.log('‚úÖ Gemini CLI module ejected');\n  }\n\n  async getStatus() {\n    const { exec } = await import('child_process');\n    const { promisify } = await import('util');\n    const execAsync = promisify(exec);\n\n    let installed = false;\n    let version = undefined;\n    let binaryPath = undefined;\n    let authenticated = false;\n\n    try {\n      const { stdout } = await execAsync('which gemini');\n      binaryPath = stdout.trim();\n      installed = true;\n      try {\n        const { stdout: versionOut } = await execAsync('gemini --version');\n        version = versionOut.trim().match(/(\\d+\\.\\d+\\.\\d+)/)?.[1];\n      } catch {}\n    } catch {}\n\n    // Check authentication status based on auth method\n    const authMethod = this.config.authMethod || 'google-login';\n    try {\n      if (authMethod === 'google-login') {\n        // Check if OAuth credentials file exists\n        const oauthCredsPath = path.join(os.homedir(), '.gemini', 'oauth_creds.json');\n        await fs.access(oauthCredsPath);\n        authenticated = true;\n      } else if (authMethod === 'api-key') {\n        // Check if API key is configured\n        authenticated = !!this.config.apiKey;\n      } else if (authMethod === 'vertex-ai') {\n        // Check if Vertex AI project is configured\n        authenticated = !!this.config.vertexProject;\n      }\n    } catch {\n      // Credentials file doesn't exist or other error\n      authenticated = false;\n    }\n\n    return {\n      installed,\n      enabled: this.config.enabled,\n      authenticated,\n      version,\n      authMethod,\n      binaryPath,\n      quotaStatus: this.rateLimiter.getQuotaStatus(),\n      lastCheck: new Date(),\n    };\n  }\n\n  isEnabled() {\n    return this.config.enabled;\n  }\n\n  getExecutor() {\n    return this.executor;\n  }\n\n  async analyze(request) {\n    if (!this.config.enabled) {\n      throw new Error('Module not enabled. Run `claude-flow gemini enable` first.');\n    }\n\n    const startTime = Date.now();\n    const requestId = `gemini-${startTime}`;\n\n    // Check rate limits\n    if (!this.rateLimiter.canMakeRequest()) {\n      await this.rateLimiter.waitForQuota();\n    }\n\n    // Build the analysis prompt based on request type\n    const analysisType = request.type || 'codebase';\n    const targetPaths = request.target || ['.'];\n    const query = request.query;\n    const depth = request.depth || 'moderate';\n\n    let prompt = this.buildAnalysisPrompt(analysisType, targetPaths, query, depth);\n\n    // Check cache first\n    const cacheKey = this.cache.generateKey({ prompt, type: analysisType, paths: targetPaths });\n    const cachedResult = await this.cache.get(cacheKey);\n    if (cachedResult) {\n      return {\n        ...cachedResult,\n        cached: true,\n        requestId,\n      };\n    }\n\n    try {\n      const { exec } = await import('child_process');\n      const { promisify } = await import('util');\n      const execAsync = promisify(exec);\n\n      // Run gemini CLI with the analysis prompt\n      const model = this.config.defaultModel || 'gemini-2.5-pro';\n      const escapedPrompt = prompt.replace(/\"/g, '\\\\\"').replace(/`/g, '\\\\`');\n\n      const { stdout, stderr } = await execAsync(\n        `gemini -m ${model} --output-format json \"${escapedPrompt}\"`,\n        {\n          timeout: this.config.analysis?.timeout || 300000,\n          maxBuffer: 50 * 1024 * 1024, // 50MB buffer for large responses\n          cwd: targetPaths[0] !== '.' ? targetPaths[0] : process.cwd(),\n        }\n      );\n\n      // Consume rate limit token\n      this.rateLimiter.consumeToken();\n\n      const duration = Date.now() - startTime;\n\n      // Parse the JSON output from gemini\n      let geminiResponse;\n      try {\n        geminiResponse = JSON.parse(stdout);\n      } catch {\n        // If not valid JSON, treat as raw text response\n        geminiResponse = { response: stdout };\n      }\n\n      const result = {\n        success: true,\n        requestId,\n        timestamp: new Date(),\n        duration,\n        tokenUsage: geminiResponse.usage || { prompt: 0, completion: 0, total: 0 },\n        summary: this.extractSummary(geminiResponse),\n        findings: this.extractFindings(geminiResponse, analysisType),\n        metrics: {\n          filesAnalyzed: targetPaths.length,\n          analysisType,\n          model,\n        },\n        recommendations: this.extractRecommendations(geminiResponse),\n        rawOutput: geminiResponse.response || stdout,\n        errors: stderr ? [stderr] : [],\n      };\n\n      // Cache the result\n      await this.cache.set(cacheKey, result);\n\n      return result;\n    } catch (err) {\n      const duration = Date.now() - startTime;\n      return {\n        success: false,\n        requestId,\n        timestamp: new Date(),\n        duration,\n        tokenUsage: { prompt: 0, completion: 0, total: 0 },\n        summary: `Analysis failed: ${err.message}`,\n        findings: [],\n        metrics: { filesAnalyzed: 0, analysisType },\n        recommendations: [],\n        errors: [err.message],\n      };\n    }\n  }\n\n  buildAnalysisPrompt(type, paths, query, depth) {\n    const depthInstructions = {\n      quick: 'Provide a brief high-level overview.',\n      moderate: 'Provide a balanced analysis with key details.',\n      deep: 'Provide an exhaustive, detailed analysis.',\n    };\n\n    const typePrompts = {\n      codebase: `Analyze this codebase comprehensively. Focus on:\n- Overall architecture and design patterns\n- Code organization and structure\n- Key components and their responsibilities\n- Potential issues or areas for improvement\n- Technology stack and dependencies`,\n\n      security: `Perform a security analysis of this codebase. Focus on:\n- Common vulnerabilities (OWASP Top 10)\n- Authentication and authorization patterns\n- Input validation and sanitization\n- Sensitive data handling\n- Security best practices violations\nRate each finding by severity: critical, high, medium, low`,\n\n      architecture: `Map the architecture of this codebase. Include:\n- System components and their relationships\n- Data flow between components\n- External integrations and APIs\n- Design patterns used\n- Potential architectural improvements`,\n\n      dependencies: `Analyze the dependencies in this project. Include:\n- Direct vs transitive dependencies\n- Outdated packages\n- Security vulnerabilities in dependencies\n- Unused dependencies\n- Dependency conflicts or issues`,\n\n      performance: `Analyze this codebase for performance. Focus on:\n- Potential bottlenecks\n- Memory usage patterns\n- Async/await usage and potential issues\n- Database query patterns\n- Caching opportunities`,\n    };\n\n    let prompt = typePrompts[type] || typePrompts.codebase;\n\n    if (query) {\n      prompt += `\\n\\nSpecific focus: ${query}`;\n    }\n\n    prompt += `\\n\\n${depthInstructions[depth] || depthInstructions.moderate}`;\n    prompt += `\\n\\nTarget paths: ${paths.join(', ')}`;\n    prompt += `\\n\\nProvide your response in a structured format with clear sections.`;\n\n    return prompt;\n  }\n\n  extractSummary(response) {\n    const maxLength = 2000; // Allow longer summaries\n    if (typeof response === 'string') return response.slice(0, maxLength);\n    if (response.response) return response.response.slice(0, maxLength);\n    if (response.summary) return response.summary;\n    return 'Analysis completed. See rawOutput for details.';\n  }\n\n  extractFindings(response, type) {\n    // Try to parse structured findings from the response\n    const text = response.response || response.text || JSON.stringify(response);\n    const findings = [];\n\n    // Look for bullet points or numbered items that could be findings\n    const lines = text.split('\\n');\n    let currentSection = null;\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n\n      // Track section headers (lines ending with : or starting with ##)\n      if (trimmed.match(/^#+\\s+/) || (trimmed.endsWith(':') && trimmed.length < 100)) {\n        currentSection = trimmed.replace(/^#+\\s*/, '').replace(/:$/, '');\n        continue;\n      }\n\n      if (trimmed.match(/^[-*‚Ä¢]\\s+/) || trimmed.match(/^\\d+\\.\\s+/)) {\n        const content = trimmed.replace(/^[-*‚Ä¢\\d.]+\\s+/, '');\n        if (content.length > 10) {\n          // Try to extract file path references\n          const fileMatch = content.match(/`([^`]+\\.(js|ts|jsx|tsx|py|go|rs|java|cpp|c|h|json|yaml|yml))`/);\n          const pathMatch = content.match(/(?:in|at|from|file)\\s+[`\"]?([a-zA-Z0-9_/.-]+\\.(js|ts|jsx|tsx|py|go|rs|java|cpp|c|h|json|yaml|yml))[`\"]?/i);\n\n          findings.push({\n            type,\n            message: content,\n            severity: this.inferSeverity(content),\n            location: fileMatch?.[1] || pathMatch?.[1] || currentSection || null,\n            category: currentSection || type,\n          });\n        }\n      }\n    }\n\n    return findings.slice(0, 50); // Limit to 50 findings\n  }\n\n  inferSeverity(text) {\n    const lower = text.toLowerCase();\n    if (lower.includes('critical') || lower.includes('severe') || lower.includes('urgent')) {\n      return 'critical';\n    }\n    if (lower.includes('high') || lower.includes('important') || lower.includes('significant')) {\n      return 'high';\n    }\n    if (lower.includes('medium') || lower.includes('moderate')) {\n      return 'medium';\n    }\n    return 'low';\n  }\n\n  extractRecommendations(response) {\n    const text = response.response || response.text || JSON.stringify(response);\n    const recommendations = [];\n\n    // Look for recommendation patterns\n    const patterns = [\n      /recommend[s]?:?\\s*([^.]+\\.)/gi,\n      /suggest[s]?:?\\s*([^.]+\\.)/gi,\n      /consider:?\\s*([^.]+\\.)/gi,\n      /should:?\\s*([^.]+\\.)/gi,\n    ];\n\n    for (const pattern of patterns) {\n      let match;\n      while ((match = pattern.exec(text)) !== null) {\n        if (match[1] && match[1].length > 10) {\n          recommendations.push(match[1].trim());\n        }\n      }\n    }\n\n    return [...new Set(recommendations)].slice(0, 20); // Dedupe and limit\n  }\n\n  getConfig() {\n    return { ...this.config };\n  }\n\n  async updateConfig(updates) {\n    this.config = { ...this.config, ...updates };\n    await this.saveConfig();\n  }\n\n  getCache() {\n    return this.cache;\n  }\n\n  getCacheStats() {\n    return this.cache.getStats();\n  }\n\n  async clearCache() {\n    await this.cache.clear();\n  }\n\n  getConfigPath() {\n    return path.join(os.homedir(), '.claude-flow', 'modules', 'gemini-cli.json');\n  }\n\n  async loadConfig() {\n    const configPath = this.getConfigPath();\n    try {\n      const content = await fs.readFile(configPath, 'utf-8');\n      const loaded = JSON.parse(content);\n      this.config = { ...DEFAULT_CONFIG, ...loaded };\n    } catch {\n      this.config = { ...DEFAULT_CONFIG };\n    }\n  }\n\n  async saveConfig() {\n    const configPath = this.getConfigPath();\n    const configDir = path.dirname(configPath);\n    await fs.mkdir(configDir, { recursive: true });\n    await fs.writeFile(configPath, JSON.stringify(this.config, null, 2), 'utf-8');\n  }\n\n  async deleteConfig() {\n    const configPath = this.getConfigPath();\n    try {\n      await fs.unlink(configPath);\n    } catch {}\n  }\n}\n\nexport function getGeminiModule() {\n  // Use TypeScript module if available, otherwise use JS fallback\n  if (_getGeminiModule) {\n    return _getGeminiModule();\n  }\n  return GeminiModuleManager.getInstance();\n}\n\nexport { GeminiModuleManager, DEFAULT_CONFIG };\n"],"names":["EventEmitter","fs","path","os","_getGeminiModule","core","getGeminiModule","DEFAULT_CONFIG","enabled","authMethod","defaultModel","contextLimit","requestsPerMinute","requestsPerDay","analysis","defaultType","outputFormat","storeInMemory","excludePatterns","maxFileSize","timeout","cache","ttl","maxSize","directory","rateLimit","burstLimit","SimpleCache","config","Map","initialize","generateKey","params","JSON","stringify","get","key","entry","Date","now","createdAt","delete","value","set","clear","getStats","entries","size","hitRate","SimpleRateLimiter","minuteTokens","dayTokens","lastMinuteRefill","lastDayRefill","canMakeRequest","refill","consumeToken","waitForQuota","Promise","resolve","setTimeout","getQuotaStatus","used","Math","floor","limit","resetAt","minuteElapsed","dayElapsed","GeminiModuleManager","instance","rateLimiter","initialized","executor","getInstance","loadConfig","enable","options","console","log","exec","spawn","promisify","execAsync","skipInstall","err","Error","message","oauthCredsPath","join","homedir","alreadyAuthenticated","access","force","reject","child","stdio","on","code","apiKey","vertexProject","vertexLocation","saveConfig","disable","eject","keepConfig","deleteConfig","getStatus","installed","version","undefined","binaryPath","authenticated","stdout","trim","versionOut","match","quotaStatus","lastCheck","isEnabled","getExecutor","analyze","request","startTime","requestId","analysisType","type","targetPaths","target","query","depth","prompt","buildAnalysisPrompt","cacheKey","paths","cachedResult","cached","model","escapedPrompt","replace","stderr","maxBuffer","cwd","process","duration","geminiResponse","parse","response","result","success","timestamp","tokenUsage","usage","completion","total","summary","extractSummary","findings","extractFindings","metrics","filesAnalyzed","length","recommendations","extractRecommendations","rawOutput","errors","depthInstructions","quick","moderate","deep","typePrompts","codebase","security","architecture","dependencies","performance","maxLength","slice","text","lines","split","currentSection","line","trimmed","endsWith","content","fileMatch","pathMatch","push","severity","inferSeverity","location","category","lower","toLowerCase","includes","patterns","pattern","Set","getConfig","updateConfig","updates","getCache","getCacheStats","clearCache","getConfigPath","configPath","readFile","loaded","configDir","dirname","mkdir","recursive","writeFile","unlink"],"mappings":"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"}